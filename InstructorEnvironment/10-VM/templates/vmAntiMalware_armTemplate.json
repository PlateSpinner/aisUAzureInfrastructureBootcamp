{ 
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "vmName": {
        "type": "string"
      },
      "exclusionPaths": {
        "type": "string",
        "defaultValue": "C:\\Users"
      },
      "exclusionExtensions": {
        "type": "string",
        "defaultValue": ".txt"
      },
      "exclusionProcesses": {
        "type": "string",
        "defaultValue": "taskmgr.exe"
      },
      "scheduledScanEnabled": {
        "type": "bool",
        "defaultValue": true
      },
      "scheduledScanType": {
        "type": "string",
        "defaultValue": "Quick",
        "allowedValues": ["Quick",
                          "Full"]
      },
      "scheduledScanDay": {
        "type": "int",
        "defaultValue": 7,
        "minValue": 1,
        "maxValue": 7
      },
      "scheduledScanTime": {
        "type": "string",
        "defaultValue": "120"
      }        
     },
    "variables": {  
     },
    "resources": [        
      {
        "type": "Microsoft.Compute/virtualMachines/extensions",
        "name": "[concat(parameters('vmName'),'/malware')]",
        "apiVersion": "2015-05-01-preview",
        "location": "[resourceGroup().location]",
        "dependsOn": [],
        "properties": {
          "publisher": "Microsoft.Azure.Security",
          "type": "IaaSAntimalware",
          "typeHandlerVersion": "1.3",
          "autoUpgradeMinorVersion": true,
          "settings": {
            "AntimalwareEnabled": "true",
            "Exclusions": {
              "Paths": "[parameters('exclusionPaths')]",
              "Extensions": "[parameters('exclusionExtensions')]",
              "Processes": "[parameters('exclusionProcesses')]"
            },
            "RealtimeProtectionEnabled": "true",
            "ScheduledScanSettings": {
              "isEnabled": "[parameters('scheduledScanEnabled')]",
              "scanType": "[parameters('scheduledScanType')]",
              "day": "[parameters('scheduledScanDay')]",
              "time": "[parameters('scheduledScanTime')]"
            }
          },
          "protectedSettings": null
        }
      }
    ]
   }
    